\section{Impacto}
\label{sec:impactoUOS}

A proposta anteriomente definida requer algumas mudanças no \emph{middleware}. Esta seção mostrará os impactos do uso da classificação para a determinação da equivalência de recursos.

O conceito do Recurso introduzido anteriormente na subseção ~\ref{subsec:introUos} do capítulo ~\ref{cap:classificacao} será afetado devido a proposta de classificação de recursos. Um dispositivo presente no \emph{smart space}, segundo a DSOA, procurava seus serviços no ambiente por meio do identificador do recurso que provê esses serviços. Com a introdução do conceito de Equivalência de Recursos, o dispositivo irá procurar por uma classe desse recurso. O identificador, em vez de representar um nome do recurso, irá, portanto, identificar que tipo de recurso ele representa, ou seja, recurso de: imagem, áudio, apontador e etc.

Baseando na arquitetura DSOA, foi construído o \emph{up (Ubiquitous Protocols)}, um conjunto de protocolos criado com objetivo de estabelecer um meio de interação entre os serviços levando em consideração a arquitetura DSOA. Tais protocolos definem o canal de comunicação e a forma de interação entre as entidades do ambiente. As mensagens são transmitidas no formato JSON (\emph{JavaScript Object Notation})~\cite{json}.

\begin{comment}
, que utiliza a codificação UTF-8~\cite{utf8}, que foi escolhido por ser um formato estruturado, leve e independente de plataforma. O JSON foi utilizado ante o XML, pois possui menor tamanho de mensagens e esse fator pode ser decisivo em um ambiente com diversos dipositivos com capacidades computacionais diferentes e possivelmente reduzidas. Dessa forma a limitação dos dispositivos é minimizada e exclui a necessidade de uma rede para tratamento dessas mensagens.
\end{comment}

Cada um dos conceitos apresentados na DSOA possui uma representação no \emph{uP} com seus respectivos atributos:

\begin{itemize}
	\item Dispositivo(\emph{UpDevice}):
	
		Por meio dos seguintes atributos, é possível identificar unicamente o dispositivo no ambiente, e quais são as interfaces rede que o dispositivo possui para realizar alguma comunicação:

	\item \emph{Driver}(\emph{UpDriver}): 

		Representa o conceito do Recurso definido na DSOA. Como um dispositivo pode ter várias instâncias de um recurso, cada instância é identificada unicamente dentro do dispositivo que contém este recurso.

	\item Serviço(\emph{UpService}): 

		Representa o conceito de mesmo nome definido na DSOA.
\end{itemize}

Além disso, com o objetivo de disponibilizar as características de visibilidade, interação e efeito, foram criados mecanismos de acesso aos recursos. O \emph{uP} é dividido em protocolos básicos, que são utilizados para invocar serviços e protocolos complementares que completam suas funcionalidades.

\begin{itemize}
	\item Protocolos Básicos: 

		São divididos em SCP (\emph{Service Call Protocol}) e EVP(\emph{Event Protocol}). O primeiro possui arquitetura provedor-consumidor, ou seja, o consumidor requisita um serviço e o provedor retorna esse serviço para ele de forma síncrona. No último, o consumidor se registra em um evento no provedor, que response informando que o registro foi realizado com sucesso, e na ocorrência do evento, o consumidor é notificado pelo provedor, demonstrando uma forma assíncrona de comunicação.
	\item Protocolos Complementares:

		Além da interação entre os serviços provida pelos protocolos básicos, o \emph{uP} tem mecanismos que permitem que as aplicações obtenham informações sobre quais são os serviços disponíveis no ambiente e informações a respeito deles. Os protocolos são divididos em um grupo de protocolos com informações sobre o dispositivo e um grupo de protocolos com informações sobre o ambiente. 
\end{itemize}

O \emph{uP} foi criado a partir dos conceitos da DSOA. Portanto, o impacto sofrido na DSOA foi diretamente refletido sobre ele. Para que a equivalência de serviços possa ser garantida, os recursos do dispositivo, cada um representado por um \emph{UpDriver}, deverá informar os recursos aos quais este é equivalente. Além disso, o identificador do recurso representará a classe deste. Dessa forma, a interface do recurso foi acrescida de um campo para informar estes \emph{drivers}. O \emph{UpDriver} ficará, portanto, com os seguintes campos:

\begin{itemize}
	\item \emph{``name''}:
		
		Representa a classe do recurso.

	\item \emph{``equivalentDrivers''}:
	
		Classes a que este recurso é equivalente.
	\item \emph{``services''}:

		Lista dos serviços síncronos do recurso.

	\item \emph{``events''}:

		Lista dos serviços assíncronos do recurso;
\end{itemize}

O campo \emph{``equivalentDrivers''} irá carregar a informação sobre a equivalência de um recurso. Entretanto, em um ambiente dinâmico, existe a possibilidade do \emph{uOS} não conhecer um destes recursos equivalentes. O dispositivo, então, ficará responsável por prover um serviço que informe ao \emph{uOS} a interface deste(s) recurso(s) desconhecido(s) e sua(s) equivalência(s) até a raiz conhecida pelo \emph{uOS}, para que o \emph{middleware} possa encontrar e registrar este novo driver na árvore de recursos. Para isso, deverá ser criado mais um serviço no protocolo \emph{Device Driver}, um dos protocolos complementares do \emph{uP}, que ficará com os seguintes serviços:

\begin{itemize}
	\item \emph{ListDrivers}: 

		Provê uma lista de instâncias dos drivers disponíveis do dispositivo. Possui dois parâmetros opcionais:
		\begin{itemize}
			\item \emph{\bf{serviceName}}: 

				Nome do serviço;
			\item \emph{\bf{driverName}}: 

				Identificador do recurso.
		\end{itemize}
	\item \emph{Handshake}: 

		Neste protocolo, dois dispositivos trocam informações entre-si. O dispositivo que invoca esse serviço passa como parâmetro um objeto do tipo \emph{device} e recebe como retorno informações sobre o dispositivo que recebeu a chamada;
	\item \emph{Goodbye}: 

		Responsável por retirar o dispositivo da lista de dispositivos presentes no ambiente;
	\item \emph{Authenticate}: 

		Estabelece um contexto de segurança entre dois dispositivos por meio de um prévio compartilhamento de chaves.

	\item \emph{TellEquivalentDrivers}:

		Responsável por informar a interface do(s) recurso(s) desconhecido(s) equivalente(s). Será composto pelos seguintes campos:

		\begin{itemize}
			\item \emph{``driversName''}:

			Lista com o(s) nome(s) do(s) recurso(s).

			\item \emph{``interfaces''}:

			Lista com a(s) interface(s) do(s) recurso(s).
		\end{itemize}
\end{itemize}

Serão afetados, ainda, dois protocolos básicos, o \emph{Service Call} e o \emph{Notify}, e o serviço \emph{ListDrivers} dos protocolos \emph{Device Driver} e \emph{Register Driver}. Todos esses serviços contém o parâmetro \emph{driver} que passará a representar uma classe dentre as classes de recursos e não mais o nome do recurso simplesmente.

Além dos protocolos, que fazem parte do \emph{middleware}, o núcleo do \emph{uOS} ficará responsável por garantir as regras que definirão se dois recursos são equivalentes e, por conseguinte, pelas validações das interfaces dos serviços. Quando um dispostivo entra no ambiente inteligente controlado pelo \emph{uOS}, o \emph{middleware} tenta trocar informações com o dispositivo por meio do serviço ``\emph{handshake}'' do protocolo \emph{DeviceDriver}. Após o ``\emph{handshake}'', o \emph{uOS} busca informações sobre os recursos que aquele dispositivo carrega. Essas informações são obtidas por meio do serviço ``\emph{listDrivers}''. Antes da introdução da equivalência de recursos, o registro de novos dispositivos parava neste segundo passo. 

O \emph{uOS} a partir de então irá, além de registrar informações sobre o recurso, irá válidar se esse recurso é de fato equivalente à outros recursos analisando uma hierarquia de equivalência. Os recursos definidos neste trabalho representam diferentes raízes na árvore de equivalência. Uma vez que um novo \emph{driver} é implementado e um dispositivo dotado deste recurso adentra ao ambiente inteligente controlado pelo \emph{uOS}, este novo \emph{driver} passa a integrar um novo ``galho'' na árvore de equivalência, caso a definição de seus serviços esteja de acordo com as regras de equivalência e consistência de interfaces.